<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autó Meghírdetése</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/forms.css">
    <style>

        .form-section {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container">
                <a class="navbar-brand" href="index.html">
                    <i class="fas fa-car"></i> AutóKereskedés
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Főoldal</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="cars.html">Autólista</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="add-car.html">Autó hozzáadása</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="gallery.html">Galéria</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Kapcsolat</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-5 pt-4">
        <section class="mb-4">
            <h1 class="text-center mb-3">Autó meghírdetése</h1>
            <h3 class="text-center ">Töltse ki az alábbi űrlapot az autó adataival</h3>
        </section>

        <article>
            <div class="form-section">
                <form id="addCarForm" novalidate>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="brand" class="form-label">Márka *</label>
                                <input type="text" class="form-control" id="brand" name="brand" required
                                       placeholder="pl. Toyota, BMW, Mercedes">
                                <div class="form-text">Add meg az autó márkáját (kötelező mező)</div>
                            </div>

                            <div class="form-group">
                                <label for="name" class="form-label">Modell *</label>
                                <input type="text" class="form-control" id="name" name="name" required
                                       placeholder="pl. Camry, 3 Series, C-Class">
                                <div class="form-text">Add meg az autó modelljét (kötelező mező)</div>
                            </div>

                            <div class="form-group">
                                <label for="manufacture_year" class="form-label">Gyártási év</label>
                                <input type="number" class="form-control" id="manufacture_year" name="manufacture_year"
                                       min="1900" max="2025" placeholder="2025">
                                <div class="form-text">Add meg a gyártási évet (1900-2024 között)</div>
                            </div>

                            <div class="form-group">
                                <label for="horsepower" class="form-label">Lóerő (HP)</label>
                                <input type="number" class="form-control" id="horsepower" name="horsepower"
                                       min="10" max="20000" placeholder="150">
                                <div class="form-text">Add meg a lóerőt (10-20000 között)</div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="color" class="form-label">Szín</label>
                                <input type="text" class="form-control" id="color" name="color" 
                                       placeholder="pl. Piros, Kék, Fehér">
                                <div class="form-text">Add meg az autó színét</div>
                            </div>

                            <div class="form-group">
                                <label for="price" class="form-label">Ár (ft)</label>
                                <input type="number" class="form-control" id="price" name="price"
                                       min="0" step="1" placeholder="2500000">
                                <div class="form-text">Add meg az autó árát</div>
                            </div>

                            <div class="form-group">
                                <label for="carImage" class="form-label">Autó képe</label>
                                <input type="file" class="form-control" id="carImage" name="carImage" accept="image/*">
                                <div class="form-text">Tölts fel egy képet az autóról (max 5MB)</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description" class="form-label">Leírás (opcionális)</label>
                        <textarea class="form-control" id="description" name="description" rows="3"
                                  placeholder="Írj leírást az autóról... (csak helyi, nem kerül a backendre)"></textarea>
                        <div class="form-text">Ez a mező csak helyileg kerül elmentésre, nem kerül a backend adatbázisába</div>
                    </div>

                    <div class="form-group mt-4">
                        <button type="submit" class="btn btn-primary btn-lg me-2">
                            <i class="fas fa-plus-circle"></i> Autó Hozzáadása
                        </button>
                        <button type="reset" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-undo"></i> Alaphelyzet
                        </button>
                        <button type="button" id="previewBtn" class="btn btn-outline-info btn-lg ms-2">
                            <i class="fas fa-eye"></i> Előnézet
                        </button>
                    </div>

                    <input type="hidden" id="imageData" name="image">
                </form>
            </div>
        </article>

        <aside id="previewSection" class="mt-4" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="fas fa-eye"></i> Űrlap Adatok Előnézete</h4>
                </div>
                <div class="card-body">
                    <div id="previewContent"></div>
                </div>
            </div>
        </aside>

        <div id="successMessage" class="alert alert-success mt-3" style="display: none;">
            <div class="d-flex align-items-center">
                <i class="fas fa-check-circle fa-2x me-3"></i>
                <div>
                    <h5 class="alert-heading mb-1">Sikeres hozzáadás!</h5>
                    <p class="mb-0" id="successDetails">Az autó hirdetése sikeresen feladva.</p>
                </div>
            </div>
        </div>

        <div id="successActions" class="text-center mt-3" style="display: none;">
            <div class="btn-group" role="group">
                <a href="cars.html" class="btn btn-outline-primary">
                    <i class="fas fa-list"></i> Összes autó megtekintése
                </a>
                <button type="button" class="btn btn-outline-success" id="addAnotherBtn">
                    <i class="fas fa-plus"></i> Új autó hozzáadása
                </button>
                <a href="index.html" class="btn btn-outline-info">
                    <i class="fas fa-home"></i> Vissza a főoldalra
                </a>
            </div>
        </div>
    </main>

    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Elérhetőség</h5>
                    <p><i class="fas fa-map-marker-alt"></i> Miskolc, Egyetem út 1, 3515</p>
                    <p><i class="fas fa-phone"></i> +36 1 234 5678</p>
                    <p><i class="fas fa-envelope"></i> info.nekuldjsemmit@hamisautokereskedes.hu</p>
                </div>
                <div class="col-md-6">
                    <h5>Nyitvatartás</h5>
                    <p>Hétfő-Péntek: 9:00 - 18:00</p>
                    <p>Szombat: 9:00 - 14:00</p>
                    <p>Vasárnap: Zárva</p>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p>&copy; 2025 AutóKereskedés. Minden jog fenntartva.</p>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="scripts/main.js"></script>
    <script src="scripts/form-validation.js"></script>
    <script src="scripts/car-manager.js"></script>
    <script>
        $(document).ready(function() {
            const carManager = new CarManager();
            const validator = new CarFormValidator('addCarForm');

            $('#carImage').on('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('A kép mérete nem haladhatja meg az 5MB-ot!');
                        $(this).val('');
                        return;
                    }
                    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                    if (!validTypes.includes(file.type)) {
                        alert('Csak JPG, PNG vagy GIF formátumú képeket tölthet fel!');
                        $(this).val('');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const base64 = e.target.result.split(',')[1];
                        $('#imageData').val(base64);
                        
                        $('#carImage').addClass('success');
                        setTimeout(() => {
                            $('#carImage').removeClass('success');
                        }, 2000);
                    };
                    reader.onerror = function() {
                        alert('Hiba történt a kép feltöltése során!');
                        $('#carImage').val('');
                    };
                    reader.readAsDataURL(file);
                } else {
                    $('#imageData').val('');
                }
            });

            $('#previewBtn').click(function() {
                const formData = {
                    brand: $('#brand').val(),
                    name: $('#name').val(),
                    manufacture_year: $('#manufacture_year').val(),
                    horsepower: $('#horsepower').val(),
                    color: $('#color').val(),
                    price: $('#price').val(),
                    image: $('#imageData').val() ? 'Kép feltöltve (' + Math.round($('#imageData').val().length / 1024) + ' KB)' : 'Nincs kép'
                };
                
                let previewHtml = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Alapadatok</h6>
                            <table class="table table-sm">
                                <tr><td><strong>Márka:</strong></td><td>${formData.brand || 'Nincs megadva'}</td></tr>
                                <tr><td><strong>Modell:</strong></td><td>${formData.name || 'Nincs megadva'}</td></tr>
                                <tr><td><strong>Évjárat:</strong></td><td>${formData.manufacture_year || 'Nincs megadva'}</td></tr>
                                <tr><td><strong>Lóerő:</strong></td><td>${formData.horsepower || 'Nincs megadva'} HP</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Egyéb adatok</h6>
                            <table class="table table-sm">
                                <tr><td><strong>Szín:</strong></td><td>${formData.color || 'Nincs megadva'}</td></tr>
                                <tr><td><strong>Ár:</strong></td><td>${formData.price ? '$' + parseFloat(formData.price).toLocaleString() : 'Nincs megadva'}</td></tr>
                                <tr><td><strong>Kép:</strong></td><td>${formData.image}</td></tr>
                            </table>
                        </div>
                    </div>
                `;
                
                $('#previewContent').html(previewHtml);
                $('#previewSection').slideDown(300);

                $('#previewSection').hide().slideDown(500).css('background-color', '#f8f9fa')
                    .animate({backgroundColor: '#ffffff'}, 1000);
            });

            $('#addCarForm').on('submit', function(e) {
                e.preventDefault();
                
                if (validator.validateForm(e)) {
                    const formData = {
                        brand: $('#brand').val().trim(),
                        name: $('#name').val().trim(),
                        manufacture_year: $('#manufacture_year').val() ? parseInt($('#manufacture_year').val()) : null,
                        horsepower: $('#horsepower').val() ? parseInt($('#horsepower').val()) : null,
                        color: $('#color').val().trim() || null,
                        price: $('#price').val() ? parseFloat($('#price').val()) : null,
                        image: $('#imageData').val() || null
                    };

                    console.log('Küldött adatok:', formData);

                    const submitBtn = $(this).find('button[type="submit"]');
                    const originalText = submitBtn.html();
                    submitBtn.html('<i class="fas fa-spinner fa-spin"></i> Hirdetés feladása...')
                             .prop('disabled', true);

                    // Görgetés a lap tetejére a visszajelzés miatt
                    $('html, body').animate({ scrollTop: 0 }, 500);

                    $.ajax({
                        url: 'http://localhost:8080/api/cars',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(formData),
                        success: (response) => {
                            // Sikeres visszajelzés
                            showSuccessMessage(response, formData);
                            
                            // Form reset
                            $('#addCarForm')[0].reset();
                            $('#imageData').val('');
                            $('#previewSection').hide();
                            submitBtn.html(originalText).prop('disabled', false);
                            
                            console.log('Sikeres hozzáadás:', response);
                        },
                        error: (xhr, status, error) => {
                            console.error('Hiba a küldés során:', error);
                            console.log('HTTP státusz:', xhr.status);
                            console.log('Válasz:', xhr.responseText);
                            
                            let errorMessage = 'Hiba történt az autó hozzáadása során.';
                            if (xhr.responseJSON && xhr.responseJSON.error) {
                                errorMessage = xhr.responseJSON.error;
                            }
                            
                            showErrorMessage(errorMessage);
                            submitBtn.html(originalText).prop('disabled', false);
                        }
                    });
                }
            });

            function showSuccessMessage(response, formData) {
                const successDetails = `
                    <strong>${formData.brand} ${formData.name}</strong> hirdetése sikeresen feladva!<br>
                    <small>Azonosító: ${response.id} • ${new Date().toLocaleString('hu-HU')}</small>
                `;
                
                $('#successDetails').html(successDetails);
                
                $('#successMessage').hide().slideDown(500).addClass('animate__animated animate__fadeInUp');
                $('#successActions').hide().delay(800).slideDown(400);
                
                createConfetti();
            }

            function showErrorMessage(message) {
                const errorHtml = `
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                            <div>
                                <h5 class="alert-heading mb-1">Hiba történt!</h5>
                                <p class="mb-0">${message}</p>
                            </div>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                
                $('#successMessage').before(errorHtml);
                setTimeout(() => {
                    $('.alert-danger').alert('close');
                }, 5000);
            }
            function createConfetti() {
                const colors = ['#28a745', '#20c997', '#0dcaf0', '#6f42c1', '#fd7e14'];
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = $('<div>').addClass('confetti').css({
                            position: 'fixed',
                            top: '-10px',
                            left: Math.random() * 100 + 'vw',
                            width: '10px',
                            height: '10px',
                            backgroundColor: colors[Math.floor(Math.random() * colors.length)],
                            borderRadius: '50%',
                            zIndex: 9999,
                            pointerEvents: 'none'
                        });
                        
                        $('body').append(confetti);
                        
                        confetti.animate({
                            top: '100vh',
                            left: confetti.position().left + (Math.random() * 200 - 100) + 'px',
                            opacity: 0
                        }, 2000, function() {
                            $(this).remove();
                        });
                    }, i * 100);
                }
            }

            $('#addAnotherBtn').click(function() {
                $('#successMessage').slideUp();
                $('#successActions').slideUp();
                $('html, body').animate({ scrollTop: $('#addCarForm').offset().top - 100 }, 500);
            });

            $('button[type="reset"]').click(function() {
                $('#imageData').val('');
                $('#previewSection').hide();
                $('#successMessage').hide();
                $('#successActions').hide();
                $('.form-control').removeClass('success error');
            });
            
            const currentYear = new Date().getFullYear();
            $('#manufacture_year').attr('max', currentYear);
        });
    </script>

    <style>
        .confetti {
            animation: confetti-fall 2s linear forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .alert-success {
            border-left: 5px solid #28a745;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .alert-danger {
            border-left: 5px solid #dc3545;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #successActions .btn {
            transition: all 0.3s ease;
        }
        
        #successActions .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
    </style>
</body>
</html>